================================================================================
NG SOS API DOCUMENTATION - COMPLETE REFERENCE
================================================================================

This file contains the complete NG SOS API documentation including all guides,
specifications summaries, and reference materials. It is generated automatically
from the documentation source files.

Generated: $(date -u +"%Y-%m-%d %H:%M:%S UTC")

================================================================================

================================================================================
LLMS.TXT - AI ASSISTANT MAP
================================================================================

# NG SOS API Documentation

> Comprehensive API documentation for the NG SOS (Next Generation State Operating System) emergency services platform. Includes three primary APIs: Emergency Message Server (EMS) for message processing, PSAP Connector for routing emergency calls to Public Safety Answering Points, and Portal URL API for web portal integration. Complete with OpenAPI specifications, narrative guides, code examples, and SDK support for TypeScript, C#, and Python.

## Overview

- Introduction: https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/docs/index.md
- Getting Started: https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/docs/getting-started.md
- GitHub Repository: https://github.com/medicalit-eu/ng-sos-apidoc

## API Reference

- EMS OpenAPI Spec (v1.0.0): https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-ems-v1.0.0.yaml
- PSAP Connector OpenAPI Spec (v2.0.0): https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-psap-connector-v2.0.0.yaml
- Portal URL OpenAPI Spec (v1.0.0): https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-portal-url-v1.0.0.yaml

## Guides

### Emergency Message Server (EMS)

- EMS Overview: https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/docs/ems/overview.md
- EMS How-To Guide: https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/docs/ems/how-to.md

### PSAP Connector

- PSAP Connector Overview: https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/docs/psap-connector/overview.md
- PSAP Connector How-To Guide: https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/docs/psap-connector/how-to.md

### Portal URL API

- Portal URL Overview: https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/docs/portal-url/overview.md
- Portal URL How-To Guide: https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/docs/portal-url/how-to.md

## SDKs

- TypeScript/JavaScript SDK: https://github.com/medicalit-eu/ng-sos-apidoc/tree/main/sdk/typescript
- C#/.NET SDK: https://github.com/medicalit-eu/ng-sos-apidoc/tree/main/sdk/csharp
- Python SDK: https://github.com/medicalit-eu/ng-sos-apidoc/tree/main/sdk/python

## Resources

- Full Documentation (llms-full.txt): https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/llms-full.txt
- Interactive Documentation: https://medicalit-eu.github.io/ng-sos-apidoc/

## Contact

- Email: mdybal@medicalit.eu
- Organization: Medical IT EU

## Allowed Domains

- github.com
- medicalit-eu.github.io
- ng-sos.com
- api.ng-sos.com
- portal.ng-sos.com



================================================================================
DOCUMENTATION INDEX
================================================================================
File: /home/runner/work/ng-sos-apidoc/ng-sos-apidoc/docs/index.md

# NG SOS API Documentation

Welcome to the NG SOS API documentation. This comprehensive resource provides everything you need to integrate with the NG SOS (Next Generation State Operating System) emergency services platform.

## Overview

The NG SOS platform consists of three primary APIs that work together to provide a complete emergency services solution:

### [Emergency Message Server (EMS)](./ems/overview.md)
The Emergency Message Server handles emergency message processing and management, including SMS reception and integration with emergency services.

- **Version**: 1.0.0
- **Purpose**: Process and manage emergency messages from multiple sources
- **Key Features**: SMS integration, message routing, emergency service integration

### [PSAP Connector Server](./psap-connector/overview.md)
The PSAP Connector Server provides connectivity between the NG SOS platform and Public Safety Answering Points (PSAPs).

- **Version**: 2.0.0
- **Purpose**: Connect emergency calls to appropriate PSAPs
- **Key Features**: Call routing, incident management, regional coordination

### [Portal URL API](./portal-url/overview.md)
The Portal URL API provides URLs and endpoints for the NG SOS portal, facilitating easy integration into third-party applications.

- **Version**: 1.0.0
- **Purpose**: Deep linking and portal integration
- **Key Features**: Incident views, pre-filled forms, archive access

## Quick Start

New to NG SOS? Start with our [Getting Started guide](./getting-started.md) to learn about:
- Authentication and API keys
- API versioning strategy
- Common error handling
- Rate limits and best practices

## API Reference

Complete OpenAPI specifications are available for each API:
- [EMS OpenAPI Spec](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-ems-v1.0.0.yaml)
- [PSAP Connector OpenAPI Spec](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-psap-connector-v2.0.0.yaml)
- [Portal URL OpenAPI Spec](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-portal-url-v1.0.0.yaml)

## SDK Support

We provide officially supported SDKs for common programming languages:
- **TypeScript/JavaScript**: `/sdk/typescript/`
- **C#/.NET**: `/sdk/csharp/`
- **Python**: `/sdk/python/`

SDKs are automatically generated from our OpenAPI specifications to ensure they stay in sync with the latest API changes.

## Support

For questions, issues, or feedback:
- **Email**: mdybal@medicalit.eu
- **GitHub**: [medicalit-eu/ng-sos-apidoc](https://github.com/medicalit-eu/ng-sos-apidoc)

## License

This documentation is maintained by Medical IT EU. For licensing information, please contact us directly.



================================================================================
GETTING STARTED GUIDE
================================================================================
File: /home/runner/work/ng-sos-apidoc/ng-sos-apidoc/docs/getting-started.md

# Getting Started

This guide will help you get up and running with the NG SOS APIs quickly and efficiently.

## Prerequisites

Before you begin, you will need:
- A valid API key (contact mdybal@medicalit.eu to obtain access)
- Basic understanding of RESTful APIs
- HTTP client library for your programming language

## Authentication

All NG SOS APIs use bearer token authentication. Include your API key in the `Authorization` header of each request:

```http
Authorization: Bearer YOUR_API_KEY
```

Example with curl:

```bash
curl -H "Authorization: Bearer YOUR_API_KEY" \
  https://api.ng-sos.com/api/endpoint
```

### Security Best Practices

You should follow these security guidelines:
- Never commit API keys to version control
- Store keys in environment variables or secure key management systems
- Rotate keys periodically
- Use different keys for development and production environments

## API Versioning

NG SOS APIs follow semantic versioning (MAJOR.MINOR.PATCH). The API version is included in the OpenAPI specification and in the base URL where applicable.

### Version Policy

- **Major versions** (e.g., 1.x.x to 2.x.x): Breaking changes that require code updates
- **Minor versions** (e.g., 1.1.x to 1.2.x): New features that are backward compatible
- **Patch versions** (e.g., 1.1.1 to 1.1.2): Bug fixes and minor improvements

When a new major version is released, the previous version will be supported for at least 12 months to allow migration time.

## Request and Response Format

All APIs use JSON for request and response bodies. Set the `Content-Type` header appropriately:

```http
Content-Type: application/json
```

Example POST request:

```json
{
  "field1": "value1",
  "field2": "value2"
}
```

## Error Handling

The NG SOS APIs use standard HTTP status codes to indicate success or failure:

### Success Codes
- **200 OK**: Request succeeded
- **201 Created**: Resource was successfully created
- **204 No Content**: Request succeeded with no response body

### Client Error Codes
- **400 Bad Request**: Invalid request format or parameters
- **401 Unauthorized**: Missing or invalid authentication
- **403 Forbidden**: Valid authentication but insufficient permissions
- **404 Not Found**: Resource does not exist
- **415 Unsupported Media Type**: Invalid Content-Type header

### Server Error Codes
- **500 Internal Server Error**: Unexpected server error
- **503 Service Unavailable**: Service temporarily unavailable

### Error Response Format

Error responses include a JSON body with details:

```json
{
  "error": {
    "code": "INVALID_REQUEST",
    "message": "Missing required field: phoneNumber",
    "details": {}
  }
}
```

## Rate Limits

To ensure fair usage and system stability, the NG SOS APIs implement rate limiting:

- **Default limit**: 100 requests per minute per API key
- **Burst limit**: 20 requests per second

When you exceed the rate limit, you will receive a `429 Too Many Requests` response. The response includes `Retry-After` header indicating when you can retry.

### Best Practices
- Implement exponential backoff when retrying failed requests
- Cache responses when appropriate
- Use webhooks instead of polling where available

## Making Your First Request

Let's make a simple request to the PSAP Connector API to get the server information:

```bash
curl -H "Authorization: Bearer YOUR_API_KEY" \
  https://api.ng-sos.com/about
```

Expected response:

```json
{
  "version": "2.0.0",
  "name": "NG SOS PSAP Connector",
  "status": "operational"
}
```

## Next Steps

Now that you understand the basics, explore the specific APIs:
- [Emergency Message Server (EMS)](./ems/overview.md)
- [PSAP Connector Server](./psap-connector/overview.md)
- [Portal URL API](./portal-url/overview.md)

Or dive into the complete [API Reference](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/) documentation.

## Getting Help

If you encounter issues or have questions:
- Check the [OpenAPI specifications](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/) for detailed endpoint documentation
- Review the how-to guides for each API
- Contact support at mdybal@medicalit.eu



================================================================================
EMS - OVERVIEW
================================================================================
File: /home/runner/work/ng-sos-apidoc/ng-sos-apidoc/docs/ems/overview.md

# Emergency Message Server (EMS) - Overview

The Emergency Message Server (EMS) is a critical component of the NG SOS platform that handles emergency message processing and management from multiple sources.

## What is EMS?

EMS acts as the central message processing hub for emergency communications. It receives messages through various integration points, processes them according to business rules, and routes them to appropriate emergency service providers.

## Key Capabilities

### SMS Integration
EMS integrates with telecommunications providers to receive and process emergency SMS messages. Currently supported:
- **Develogi Integration**: Receive SMS messages and status updates through the Develogi platform

### Message Processing
The server processes incoming emergency messages by:
- Validating message format and content
- Extracting location information when available
- Categorizing message urgency and type
- Routing to appropriate emergency services

### Mobile App Integration
EMS provides endpoints for mobile applications to:
- Report incidents directly
- Update incident status
- Provide location and multimedia data

### PSAP Connector Integration
EMS works in tandem with the PSAP Connector to ensure emergency messages reach the right Public Safety Answering Points.

## Architecture

EMS follows a microservices architecture pattern with these main components:

```
[SMS Provider] ---> [EMS API] ---> [Message Queue] ---> [PSAP Connector]
                        |
                [Mobile Apps] ---> [EMS API]
```

## Use Cases

### Use Case 1: SMS Emergency Alert
A citizen sends an emergency SMS to a designated number. EMS:
1. Receives the SMS via Develogi integration
2. Parses the message content and extracts metadata
3. Determines the caller's location (if available)
4. Routes the alert to the appropriate PSAP
5. Sends confirmation back to the sender

### Use Case 2: Mobile App Incident Report
A mobile app user reports an emergency. EMS:
1. Receives structured incident data via API
2. Validates the incident information
3. Enriches with location data
4. Creates an incident record
5. Notifies relevant emergency services

### Use Case 3: Status Updates
Emergency service providers can query and update incident status through EMS endpoints.

## API Organization

The EMS API is organized by integration type:

- **Develogi Integration** (`/integrations/develogi/v1/*`): SMS reception and status updates
- **Mobile Integration**: Endpoints for mobile app incident reporting
- **PSAP Integration**: Connectivity with PSAP Connector services

## Getting Started

To start using the EMS API:

1. Review the [Getting Started guide](../getting-started.md) for authentication
2. Check the [EMS How-To guide](./how-to.md) for common tasks
3. Explore the [OpenAPI specification](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-ems-v1.0.0.yaml) for complete endpoint details

## Data Model

### Key Resources

**Emergency Message**: The core entity representing an emergency communication
- Source (SMS, mobile app, etc.)
- Content and metadata
- Location information
- Timestamp and status

**Integration Event**: Record of external system interactions
- Integration type (Develogi, etc.)
- Event type (received, delivered, failed)
- Payload and response data

## Security

EMS implements multiple security layers:
- Bearer token authentication for all endpoints
- Request validation and sanitization
- Rate limiting to prevent abuse
- Audit logging of all operations

## Performance

EMS is designed for high availability:
- Sub-second response times for message reception
- Automatic failover and redundancy
- Horizontal scaling capability
- Message queue for reliable delivery

## Next Steps

- Learn [how to perform common tasks](./how-to.md) with EMS
- Review the [complete API reference](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-ems-v1.0.0.yaml)
- Explore [PSAP Connector integration](../psap-connector/overview.md)



================================================================================
EMS - HOW-TO GUIDE
================================================================================
File: /home/runner/work/ng-sos-apidoc/ng-sos-apidoc/docs/ems/how-to.md

# Emergency Message Server (EMS) - How-To Guide

This guide provides step-by-step instructions for common tasks with the EMS API.

## How to Receive SMS Messages

The EMS API receives SMS messages through the Develogi integration endpoint.

### Endpoint
```
POST /integrations/develogi/v1/sms-receive
```

### Prerequisites
- Valid API authentication token
- Develogi integration configured

### Request Example

```bash
curl -X POST https://api.ng-sos.com/integrations/develogi/v1/sms-receive \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "phoneNumber": "+420123456789",
    "message": "Emergency at Main Street 123, Prague",
    "timestamp": "2024-01-09T13:00:00Z",
    "messageId": "msg-12345"
  }'
```

### Response

On success, you receive a `200 OK` response:

```json
{
  "status": "received",
  "incidentId": "inc-67890"
}
```

### Error Handling

If the request fails, check these common issues:
- **400 Bad Request**: Missing required fields (phoneNumber, message, timestamp)
- **401 Unauthorized**: Invalid or missing API token
- **415 Unsupported Media Type**: Missing or incorrect Content-Type header

## How to Update SMS Status

Update the delivery status of an SMS that was sent through the system.

### Endpoint
```
POST /integrations/develogi/v1/sms-status
```

### Request Example

```bash
curl -X POST https://api.ng-sos.com/integrations/develogi/v1/sms-status \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "messageId": "msg-12345",
    "status": "delivered",
    "timestamp": "2024-01-09T13:05:00Z"
  }'
```

### Status Values
- `sent`: Message was sent from the system
- `delivered`: Message was delivered to recipient
- `failed`: Delivery failed
- `pending`: Message is queued for delivery

### Response

```json
{
  "status": "updated",
  "messageId": "msg-12345"
}
```

## How to Handle Mobile App Incidents

Mobile applications can report incidents directly to EMS.

### Endpoint
```
POST /api/v1/incidents
```

### Request Example

```bash
curl -X POST https://api.ng-sos.com/api/v1/incidents \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "medical",
    "description": "Person collapsed in shopping center",
    "location": {
      "latitude": 50.0755,
      "longitude": 14.4378,
      "address": "Palladium Shopping Center, Prague"
    },
    "reporter": {
      "name": "John Doe",
      "phone": "+420123456789"
    },
    "severity": "high"
  }'
```

### Response

```json
{
  "incidentId": "inc-67890",
  "status": "created",
  "estimatedResponseTime": "5 minutes",
  "confirmationCode": "CODE-1234"
}
```

## How to Query Incident Status

Check the current status of an incident.

### Endpoint
```
GET /api/v1/incidents/{incidentId}
```

### Request Example

```bash
curl -X GET https://api.ng-sos.com/api/v1/incidents/inc-67890 \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### Response

```json
{
  "incidentId": "inc-67890",
  "status": "in_progress",
  "type": "medical",
  "created": "2024-01-09T13:00:00Z",
  "updated": "2024-01-09T13:05:00Z",
  "assignedTo": "PSAP-Prague-Central",
  "location": {
    "latitude": 50.0755,
    "longitude": 14.4378,
    "address": "Palladium Shopping Center, Prague"
  }
}
```

### Status Values
- `created`: Incident was created and is being processed
- `assigned`: Incident assigned to a PSAP
- `in_progress`: Emergency services are responding
- `resolved`: Incident has been resolved
- `cancelled`: Incident was cancelled

## How to Integrate with PSAP Connector

EMS works together with the PSAP Connector to route emergencies. Here's how they interact:

### Step 1: EMS Receives Emergency
EMS receives an emergency message (via SMS or mobile app).

### Step 2: EMS Creates Incident
EMS processes the message and creates an incident record.

### Step 3: EMS Notifies PSAP Connector
EMS sends the incident to the PSAP Connector for routing:

```bash
curl -X POST https://api.ng-sos.com/api/v1/psap-connector/incidents \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "incidentId": "inc-67890",
    "location": {
      "latitude": 50.0755,
      "longitude": 14.4378
    },
    "type": "medical"
  }'
```

### Step 4: PSAP Connector Routes to Appropriate PSAP
The PSAP Connector determines which PSAP should handle the incident based on location and type.

Check the [PSAP Connector documentation](../psap-connector/overview.md) for more details on the routing logic.

## Best Practices

### Message Validation
Always validate incoming messages before processing:
- Check for required fields
- Validate phone number format
- Sanitize message content to prevent injection attacks

### Error Recovery
Implement retry logic with exponential backoff:
```javascript
async function sendWithRetry(data, maxRetries = 3) {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await sendToEMS(data);
    } catch (error) {
      if (i === maxRetries - 1) throw error;
      await sleep(Math.pow(2, i) * 1000);
    }
  }
}
```

### Logging
Log all emergency messages for audit and debugging:
- Message content (with PII considerations)
- Timestamps
- Processing results
- Error conditions

### Testing
Test your integration thoroughly:
- Use test API keys in development
- Verify error handling with invalid data
- Test rate limiting behavior
- Validate location data accuracy

## Troubleshooting

### Common Issues

**Issue**: 401 Unauthorized responses
- **Solution**: Verify your API key is correct and included in the Authorization header

**Issue**: Messages not being routed
- **Solution**: Check that location data is valid and falls within a supported region

**Issue**: Rate limit errors (429)
- **Solution**: Implement exponential backoff and reduce request frequency

**Issue**: Location parsing failures
- **Solution**: Ensure latitude/longitude are within valid ranges (-90 to 90, -180 to 180)

## Additional Resources

- [EMS OpenAPI Specification](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-ems-v1.0.0.yaml)
- [Getting Started Guide](../getting-started.md)
- [PSAP Connector Documentation](../psap-connector/overview.md)

## Support

For technical support or questions:
- Email: mdybal@medicalit.eu
- GitHub Issues: [medicalit-eu/ng-sos-apidoc](https://github.com/medicalit-eu/ng-sos-apidoc)



================================================================================
PSAP CONNECTOR - OVERVIEW
================================================================================
File: /home/runner/work/ng-sos-apidoc/ng-sos-apidoc/docs/psap-connector/overview.md

# PSAP Connector Server - Overview

The PSAP Connector Server is a critical routing component of the NG SOS platform that connects emergency incidents to the appropriate Public Safety Answering Points (PSAPs).

## What is PSAP Connector?

The PSAP Connector acts as an intelligent routing layer between the Emergency Message Server and regional PSAPs. It determines which PSAP should handle each incident based on location, incident type, and PSAP capacity.

## Key Capabilities

### Intelligent Routing
The PSAP Connector analyzes incident data to determine the optimal PSAP:
- Geographic location-based routing
- Incident type matching (medical, fire, police)
- PSAP availability and capacity
- Backup routing when primary PSAP is unavailable

### Incident Management
Comprehensive incident lifecycle management:
- Incident assignment to PSAPs
- Status tracking and updates
- Region-based incident organization
- Collaboration between multiple PSAPs

### PSAP Integration
Seamless connectivity with PSAP systems:
- Real-time incident notification
- Two-way status synchronization
- Collaboration confirmation/rejection
- Region management

### System Information
Operational endpoints for monitoring:
- Server health and status (`/about`)
- Version information
- Configuration details

## Architecture

The PSAP Connector sits between EMS and regional PSAPs:

```
[EMS] ---> [PSAP Connector] ---> [PSAP Prague]
                |
                +---> [PSAP Brno]
                |
                +---> [PSAP Ostrava]
```

## Use Cases

### Use Case 1: Geographic Routing
An emergency occurs in Prague. The PSAP Connector:
1. Receives incident from EMS with location data
2. Determines the incident is within Prague PSAP jurisdiction
3. Routes the incident to Prague PSAP
4. Confirms assignment with EMS
5. Monitors incident status

### Use Case 2: Multi-PSAP Collaboration
A large-scale incident requires multiple PSAPs. The PSAP Connector:
1. Assigns the primary incident to the local PSAP
2. Identifies affected regions requiring collaboration
3. Sends collaboration requests to neighboring PSAPs
4. Coordinates responses and status updates
5. Manages the collaborative response

### Use Case 3: Failover Routing
The primary PSAP is at capacity or unavailable. The PSAP Connector:
1. Detects primary PSAP unavailability
2. Identifies backup PSAP based on jurisdiction overlap
3. Routes incident to backup PSAP
4. Notifies EMS of the routing change
5. Restores primary routing when available

## API Organization

The PSAP Connector API is organized by functional area:

- **About** (`/about`): Server information and health status
- **Incidents** (`/api/v1/incidents/*`): Incident assignment and management
- **Regions** (`/api/v1/regions/*`): Region-based incident queries
- **Collaboration** (`/api/v1/collaboration/*`): Multi-PSAP coordination

## Getting Started

To start using the PSAP Connector API:

1. Review the [Getting Started guide](../getting-started.md) for authentication
2. Check the [PSAP Connector How-To guide](./how-to.md) for common tasks
3. Explore the [OpenAPI specification](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-psap-connector-v2.0.0.yaml)

## Data Model

### Key Resources

**Incident Assignment**: Links incidents to PSAPs
- Incident ID from EMS
- Assigned PSAP identifier
- Assignment timestamp
- Status (assigned, accepted, in_progress, resolved)

**Region**: Geographic area served by a PSAP
- Region identifier and name
- Geographic boundaries
- Assigned PSAP
- Priority and capacity

**Collaboration Request**: Multi-PSAP coordination
- Primary incident
- Requesting PSAP
- Supporting PSAPs
- Collaboration status

## Routing Logic

The PSAP Connector uses sophisticated routing logic:

### Primary Routing Factors
1. **Geographic location**: Incident coordinates matched to PSAP regions
2. **Incident type**: Some PSAPs specialize in specific emergency types
3. **PSAP capacity**: Available resources and current load
4. **Priority rules**: Configurable routing policies

### Fallback Mechanisms
- Nearest PSAP when location is ambiguous
- Round-robin when multiple PSAPs serve the same area
- Manual override capability for special cases

## Security

The PSAP Connector implements enterprise-grade security:
- Mutual TLS for PSAP connections
- Bearer token authentication for API access
- Role-based access control (RBAC)
- Comprehensive audit logging
- Encryption at rest and in transit

## High Availability

Designed for 99.99% uptime:
- Active-active clustering
- Geographic redundancy
- Automatic failover
- Health monitoring and alerting
- Zero-downtime updates

## Performance

Optimized for emergency response:
- Sub-100ms routing decisions
- Supports 10,000+ concurrent incidents
- Real-time status updates
- Efficient database queries with caching

## Monitoring and Observability

Built-in monitoring capabilities:
- Prometheus metrics endpoints
- Structured logging (JSON)
- OpenTelemetry tracing
- Health check endpoints
- Performance dashboards

## Integration Points

### Upstream: Emergency Message Server
Receives incident notifications from EMS with:
- Incident details and metadata
- Location information
- Incident type and severity
- Reporter information

### Downstream: PSAP Systems
Sends incident assignments to PSAPs via:
- REST API integration
- Webhook notifications
- Message queue (when configured)
- Legacy protocol adapters (when needed)

## Versioning

PSAP Connector follows semantic versioning:
- **Current version**: 2.0.0
- **Previous version**: 1.x.x (deprecated, supported until 2025-12-31)

Version 2.0 introduces:
- Enhanced routing algorithms
- Multi-region collaboration
- Improved performance and scalability
- New REST API endpoints

## Next Steps

- Learn [how to perform common tasks](./how-to.md) with PSAP Connector
- Review the [complete API reference](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-psap-connector-v2.0.0.yaml)
- Explore [EMS integration](../ems/overview.md)
- Understand [Portal URL API](../portal-url/overview.md) for UI integration



================================================================================
PSAP CONNECTOR - HOW-TO GUIDE
================================================================================
File: /home/runner/work/ng-sos-apidoc/ng-sos-apidoc/docs/psap-connector/how-to.md

# PSAP Connector Server - How-To Guide

This guide provides step-by-step instructions for common tasks with the PSAP Connector API.

## How to Check Server Status

Query the PSAP Connector to verify it's operational and get version information.

### Endpoint
```
GET /about
```

### Request Example

```bash
curl -X GET https://api.ng-sos.com/about \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### Response

```json
{
  "name": "NG SOS PSAP Connector",
  "version": "2.0.0",
  "status": "operational",
  "uptime": "15d 7h 23m",
  "connectedPsaps": 5
}
```

### Use Cases
- Health monitoring and alerting
- Version compatibility checks
- Deployment verification

## How to Assign an Incident to a PSAP

Route an emergency incident to the appropriate PSAP based on location and type.

### Endpoint
```
POST /api/v1/incidents/assign
```

### Prerequisites
- Valid incident ID from EMS
- Location data (latitude/longitude or address)
- Incident type

### Request Example

```bash
curl -X POST https://api.ng-sos.com/api/v1/incidents/assign \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "incidentId": "inc-67890",
    "location": {
      "latitude": 50.0755,
      "longitude": 14.4378,
      "address": "Palladium Shopping Center, Prague"
    },
    "type": "medical",
    "severity": "high",
    "description": "Person collapsed in shopping center"
  }'
```

### Response

```json
{
  "assignmentId": "asn-12345",
  "incidentId": "inc-67890",
  "assignedPsap": {
    "id": "psap-prague-central",
    "name": "Prague Central PSAP",
    "region": "Prague"
  },
  "status": "assigned",
  "estimatedResponseTime": "5 minutes",
  "assignedAt": "2024-01-09T13:00:00Z"
}
```

### Routing Logic

The PSAP Connector automatically determines the best PSAP based on:
1. Geographic location (primary factor)
2. Incident type specialization
3. Current PSAP capacity and availability
4. Configured routing rules

### Error Handling

Common errors:
- **400 Bad Request**: Missing required fields or invalid location data
- **404 Not Found**: No PSAP found for the given location
- **503 Service Unavailable**: All PSAPs at capacity

## How to Query Incidents by Region

Retrieve all incidents for a specific geographic region.

### Endpoint
```
GET /api/v1/regions/{regionId}/incidents
```

### Request Example

```bash
curl -X GET "https://api.ng-sos.com/api/v1/regions/prague/incidents?status=active" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### Query Parameters
- `status`: Filter by incident status (active, resolved, all)
- `type`: Filter by incident type (medical, fire, police)
- `since`: Return incidents since timestamp (ISO 8601)
- `limit`: Maximum number of results (default: 50, max: 200)

### Response

```json
{
  "region": "prague",
  "totalIncidents": 3,
  "incidents": [
    {
      "incidentId": "inc-67890",
      "type": "medical",
      "status": "in_progress",
      "location": {
        "latitude": 50.0755,
        "longitude": 14.4378,
        "address": "Palladium Shopping Center"
      },
      "assignedPsap": "psap-prague-central",
      "createdAt": "2024-01-09T13:00:00Z"
    },
    {
      "incidentId": "inc-67891",
      "type": "fire",
      "status": "active",
      "location": {
        "latitude": 50.0880,
        "longitude": 14.4207,
        "address": "Old Town Square"
      },
      "assignedPsap": "psap-prague-fire",
      "createdAt": "2024-01-09T13:15:00Z"
    }
  ]
}
```

## How to Request Multi-PSAP Collaboration

For large-scale incidents requiring coordination between multiple PSAPs.

### Endpoint
```
POST /api/v1/collaboration/request
```

### Request Example

```bash
curl -X POST https://api.ng-sos.com/api/v1/collaboration/request \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "incidentId": "inc-67892",
    "requestingPsap": "psap-prague-central",
    "supportingPsaps": [
      "psap-prague-fire",
      "psap-central-bohemia"
    ],
    "reason": "Multi-vehicle accident on highway, requires fire and medical response across region boundaries",
    "priority": "high"
  }'
```

### Response

```json
{
  "collaborationId": "collab-45678",
  "incidentId": "inc-67892",
  "status": "pending",
  "requestingPsap": "psap-prague-central",
  "supportingPsaps": [
    {
      "psapId": "psap-prague-fire",
      "status": "notified",
      "notifiedAt": "2024-01-09T13:30:00Z"
    },
    {
      "psapId": "psap-central-bohemia",
      "status": "notified",
      "notifiedAt": "2024-01-09T13:30:00Z"
    }
  ]
}
```

## How to Confirm or Reject Collaboration

PSAPs can accept or decline collaboration requests.

### Confirm Collaboration

```bash
curl -X POST https://api.ng-sos.com/api/v1/collaboration/collab-45678/confirm \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "psapId": "psap-prague-fire",
    "resources": {
      "units": 2,
      "personnel": 8,
      "estimatedArrival": "10 minutes"
    }
  }'
```

### Reject Collaboration

```bash
curl -X POST https://api.ng-sos.com/api/v1/collaboration/collab-45678/reject \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "psapId": "psap-central-bohemia",
    "reason": "All units currently deployed to other emergencies"
  }'
```

### Response (Confirm)

```json
{
  "collaborationId": "collab-45678",
  "psapId": "psap-prague-fire",
  "status": "confirmed",
  "confirmedAt": "2024-01-09T13:32:00Z",
  "resources": {
    "units": 2,
    "personnel": 8,
    "estimatedArrival": "10 minutes"
  }
}
```

## How to Update Incident Status

Update the current status of an incident being handled by a PSAP.

### Endpoint
```
PATCH /api/v1/incidents/{incidentId}/status
```

### Request Example

```bash
curl -X PATCH https://api.ng-sos.com/api/v1/incidents/inc-67890/status \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "status": "in_progress",
    "psapId": "psap-prague-central",
    "notes": "Ambulance dispatched, ETA 3 minutes",
    "respondingUnits": [
      {
        "unitId": "amb-101",
        "type": "ambulance",
        "personnel": 2
      }
    ]
  }'
```

### Status Values
- `assigned`: Incident assigned to PSAP
- `accepted`: PSAP confirmed receipt
- `in_progress`: Emergency response underway
- `resolved`: Incident resolved
- `cancelled`: Incident cancelled (false alarm)
- `transferred`: Incident transferred to another PSAP

### Response

```json
{
  "incidentId": "inc-67890",
  "status": "in_progress",
  "updatedAt": "2024-01-09T13:35:00Z",
  "updatedBy": "psap-prague-central",
  "history": [
    {
      "status": "assigned",
      "timestamp": "2024-01-09T13:00:00Z"
    },
    {
      "status": "accepted",
      "timestamp": "2024-01-09T13:01:00Z"
    },
    {
      "status": "in_progress",
      "timestamp": "2024-01-09T13:35:00Z"
    }
  ]
}
```

## How to List Available Regions

Query all regions served by the PSAP Connector.

### Endpoint
```
GET /api/v1/regions
```

### Request Example

```bash
curl -X GET https://api.ng-sos.com/api/v1/regions \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### Response

```json
{
  "totalRegions": 5,
  "regions": [
    {
      "id": "prague",
      "name": "Prague",
      "country": "Czech Republic",
      "psaps": [
        {
          "id": "psap-prague-central",
          "name": "Prague Central PSAP",
          "types": ["medical", "police"]
        },
        {
          "id": "psap-prague-fire",
          "name": "Prague Fire Department",
          "types": ["fire"]
        }
      ],
      "coordinates": {
        "center": {"latitude": 50.0755, "longitude": 14.4378},
        "bounds": {
          "north": 50.1773,
          "south": 49.9419,
          "east": 14.7068,
          "west": 14.2244
        }
      }
    }
  ]
}
```

## Best Practices

### Routing Optimization
- Always provide accurate location data (latitude/longitude)
- Include detailed incident descriptions to aid routing
- Specify incident type and severity correctly

### Status Updates
- Update incident status in real-time as situations evolve
- Include relevant details in status notes
- Use appropriate status values for accurate tracking

### Collaboration
- Only request collaboration when truly needed
- Provide clear reasons for collaboration requests
- Respond to collaboration requests promptly

### Error Handling
Implement robust error handling:

```javascript
async function assignIncidentWithRetry(incident) {
  try {
    return await assignIncident(incident);
  } catch (error) {
    if (error.status === 404) {
      // No PSAP found - try expanding search radius
      console.error('No PSAP found for location:', incident.location);
      // Implement fallback logic
    } else if (error.status === 503) {
      // PSAPs at capacity - escalate
      console.error('All PSAPs unavailable');
      // Implement escalation logic
    }
    throw error;
  }
}
```

## Troubleshooting

### Common Issues

**Issue**: No PSAP found for location (404)
- **Solution**: Verify latitude/longitude are valid and within served regions
- **Solution**: Check if region configuration includes the location

**Issue**: Assignment fails with 503
- **Solution**: All PSAPs may be at capacity - check PSAP status
- **Solution**: Implement queue logic or escalation procedures

**Issue**: Collaboration requests timing out
- **Solution**: Ensure supporting PSAPs have valid configurations
- **Solution**: Check network connectivity to PSAPs

**Issue**: Status updates not reflected
- **Solution**: Verify incident ID is correct
- **Solution**: Check that PSAP has permission to update the incident

## Integration Examples

### Node.js/TypeScript

```typescript
import { PsapConnectorClient } from '@ng-sos/psap-connector-sdk';

const client = new PsapConnectorClient({
  apiKey: process.env.NG_SOS_API_KEY
});

// Assign an incident
const assignment = await client.incidents.assign({
  incidentId: 'inc-67890',
  location: { latitude: 50.0755, longitude: 14.4378 },
  type: 'medical',
  severity: 'high'
});

console.log(`Assigned to: ${assignment.assignedPsap.name}`);
```

### Python

```python
from ng_sos import PsapConnectorClient

client = PsapConnectorClient(api_key=os.environ['NG_SOS_API_KEY'])

# Query region incidents
incidents = client.regions.get_incidents(
    region_id='prague',
    status='active'
)

for incident in incidents:
    print(f"Incident {incident.id}: {incident.status}")
```

## Additional Resources

- [PSAP Connector OpenAPI Specification](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-psap-connector-v2.0.0.yaml)
- [Getting Started Guide](../getting-started.md)
- [EMS Documentation](../ems/overview.md)

## Support

For technical support:
- Email: mdybal@medicalit.eu
- GitHub: [medicalit-eu/ng-sos-apidoc](https://github.com/medicalit-eu/ng-sos-apidoc)



================================================================================
PORTAL URL API - OVERVIEW
================================================================================
File: /home/runner/work/ng-sos-apidoc/ng-sos-apidoc/docs/portal-url/overview.md

# Portal URL API - Overview

The Portal URL API provides deep linking capabilities for the NG SOS web portal, enabling third-party applications to integrate seamlessly with the NG SOS platform through URL-based navigation.

## What is Portal URL API?

The Portal URL API is a simple but powerful interface that allows external applications to generate URLs pointing to specific views and forms within the NG SOS portal. Instead of building complex UI integrations, you can redirect users to pre-configured portal pages with context-specific parameters.

## Key Capabilities

### Deep Linking
Create direct links to specific portal pages:
- Incident list with filters
- Individual incident details
- Pre-filled incident creation forms
- Incident archive with search parameters

### Pre-filled Forms
Launch the portal with forms populated with data:
- Incident type pre-selected
- Location information pre-filled
- Description template applied
- Priority and tags set

### Context Preservation
Maintain user context across systems:
- Return URLs for navigation back to source application
- Session continuity through secure tokens
- State preservation in URL parameters

## Use Cases

### Use Case 1: Emergency Dispatcher Dashboard
A dispatcher dashboard displays active incidents. When a dispatcher clicks an incident:
1. Dashboard generates a Portal URL with incident ID
2. User is redirected to NG SOS portal
3. Portal displays detailed incident view
4. Dispatcher performs actions in portal
5. Portal redirects back to dashboard when complete

### Use Case 2: Mobile App Integration
A mobile app detects an emergency situation:
1. App collects location and incident details
2. Generates Portal URL with pre-filled incident form
3. Opens portal in mobile browser
4. User confirms/edits details and submits
5. Portal creates incident and shows confirmation

### Use Case 3: Third-Party Report System
An external system needs to file an incident report:
1. System generates Portal URL with incident data
2. Authorized user clicks link
3. Portal displays pre-filled form for review
4. User confirms and submits
5. Incident is created in NG SOS

### Use Case 4: Archive Search
An analyst needs to review past incidents:
1. Generate Portal URL with archive filters (date range, type, region)
2. Portal displays filtered incident archive
3. Analyst reviews historical data
4. Export or additional filtering available in portal

## API Organization

The Portal URL API consists of simple GET endpoints that return web pages:

- **Incident List** (`/incident-list`): View active incidents
- **Incident Details** (`/incident-detail`): View specific incident
- **Create Incident** (`/create-incident`): Pre-filled incident form
- **Incident Archive** (`/incident-archive`): Historical incident search

## Getting Started

To use the Portal URL API:

1. Review the [Getting Started guide](../getting-started.md) for authentication
2. Check the [Portal URL How-To guide](./how-to.md) for URL generation
3. Explore the [OpenAPI specification](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-portal-url-v1.0.0.yaml)

## URL Structure

Portal URLs follow a consistent pattern:

```
https://portal.ng-sos.com/{endpoint}?param1=value1&param2=value2
```

### Authentication

Authentication is handled through:
- **Session cookies**: For logged-in users
- **API tokens**: For programmatic access (passed as query parameter or header)
- **OAuth redirect**: For third-party applications

## Data Model

### Query Parameters

**Common Parameters**:
- `token`: API authentication token (alternative to cookies)
- `returnUrl`: URL to redirect after action completion
- `lang`: Language code (en, cs, de, etc.)

**Incident Parameters**:
- `incidentId`: Unique incident identifier
- `type`: Incident type (medical, fire, police, other)
- `latitude`, `longitude`: Location coordinates
- `address`: Human-readable address
- `description`: Incident description
- `priority`: Priority level (low, medium, high, critical)

**Filter Parameters**:
- `dateFrom`, `dateTo`: Date range for archive
- `status`: Incident status filter
- `region`: Geographic region filter

## Security Considerations

### URL Security
- Never include sensitive data in URLs that will be logged
- Use POST for sensitive operations (not GET)
- Validate all parameters server-side
- Implement CSRF protection

### Token Handling
- API tokens in URLs have limited lifetime (5 minutes default)
- Single-use tokens for sensitive operations
- Rate limiting on URL generation

### Cross-Origin
- CORS headers configured for approved domains
- Referer checking for additional security
- CSP headers to prevent XSS

## Browser Compatibility

The Portal URL API works with:
- Chrome/Edge 90+
- Firefox 88+
- Safari 14+
- Mobile browsers (iOS Safari, Chrome Android)

## Performance

Portal URL endpoints are optimized for:
- Fast redirect times (< 100ms)
- Minimal data transfer
- Efficient parameter parsing
- Cached static assets

## Limitations

### URL Length
- Maximum URL length: 2000 characters
- Consider POST for large data payloads
- Use URL shortener for very long URLs

### Parameter Size
- Individual parameters limited to 1000 characters
- Description field limited to 2000 characters
- Use ellipsis for truncated text

## Integration Patterns

### Pattern 1: Simple Redirect
Direct browser redirect for basic integration:
```html
<a href="https://portal.ng-sos.com/incident-list">View Incidents</a>
```

### Pattern 2: Programmatic Generation
Generate URLs server-side with parameters:
```javascript
function generateIncidentUrl(incident) {
  const params = new URLSearchParams({
    type: incident.type,
    latitude: incident.location.lat,
    longitude: incident.location.lng,
    description: incident.description
  });
  return `https://portal.ng-sos.com/create-incident?${params}`;
}
```

### Pattern 3: Popup Integration
Open portal in popup window:
```javascript
function openIncidentInPortal(incidentId) {
  const url = `https://portal.ng-sos.com/incident-detail?incidentId=${incidentId}`;
  window.open(url, 'ngsos', 'width=1200,height=800');
}
```

### Pattern 4: iFrame Embedding
Embed portal views in your application:
```html
<iframe 
  src="https://portal.ng-sos.com/incident-list?token=YOUR_TOKEN"
  width="100%" 
  height="600"
  sandbox="allow-same-origin allow-scripts">
</iframe>
```

## Versioning

Portal URL API follows semantic versioning:
- **Current version**: 1.0.0
- Backward compatible changes increment minor version
- Breaking changes increment major version

URL structure is stable; new parameters are additive.

## Monitoring

Track Portal URL API usage:
- Request count and response times
- Parameter validation errors
- Authentication failures
- User agent and referrer statistics

## Next Steps

- Learn [how to generate URLs](./how-to.md) for different scenarios
- Review the [complete API reference](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-portal-url-v1.0.0.yaml)
- Explore [EMS](../ems/overview.md) and [PSAP Connector](../psap-connector/overview.md) APIs



================================================================================
PORTAL URL API - HOW-TO GUIDE
================================================================================
File: /home/runner/work/ng-sos-apidoc/ng-sos-apidoc/docs/portal-url/how-to.md

# Portal URL API - How-To Guide

This guide shows you how to generate and use Portal URLs for different integration scenarios.

## How to Open Incident List

Display a list of active incidents in the NG SOS portal.

### Endpoint
```
GET /incident-list
```

### Basic Usage

```html
<a href="https://portal.ng-sos.com/incident-list">View All Incidents</a>
```

### With Filters

```javascript
const url = new URL('https://portal.ng-sos.com/incident-list');
url.searchParams.append('status', 'active');
url.searchParams.append('type', 'medical');
url.searchParams.append('region', 'prague');

// Result: https://portal.ng-sos.com/incident-list?status=active&type=medical&region=prague
```

### Available Parameters
- `status`: Filter by status (active, resolved, all)
- `type`: Filter by type (medical, fire, police, other)
- `region`: Filter by region (prague, brno, ostrava, etc.)
- `priority`: Filter by priority (low, medium, high, critical)
- `dateFrom`: Start date (ISO 8601 format)
- `dateTo`: End date (ISO 8601 format)

### Response

The user is redirected to the portal showing a filtered incident list:
```
https://portal.ng-sos.com/incident-list?type=medical&region=prague
```

## How to View Incident Details

Open a specific incident's detail page.

### Endpoint
```
GET /incident-detail
```

### Required Parameters
- `incidentId`: The unique incident identifier

### Example

```javascript
function viewIncident(incidentId) {
  const url = `https://portal.ng-sos.com/incident-detail?incidentId=${incidentId}`;
  window.location.href = url;
}

// Usage
viewIncident('inc-67890');
```

### With Return URL

```javascript
function viewIncidentWithReturn(incidentId) {
  const returnUrl = encodeURIComponent(window.location.href);
  const url = `https://portal.ng-sos.com/incident-detail?incidentId=${incidentId}&returnUrl=${returnUrl}`;
  window.open(url, '_blank');
}
```

### With Authentication Token

```javascript
async function viewIncidentWithToken(incidentId, apiToken) {
  const url = new URL('https://portal.ng-sos.com/incident-detail');
  url.searchParams.append('incidentId', incidentId);
  url.searchParams.append('token', apiToken);
  
  window.location.href = url.toString();
}
```

## How to Pre-fill Incident Creation Form

Generate a URL that opens the incident creation form with pre-filled data.

### Endpoint
```
GET /create-incident
```

### Example with Location

```javascript
function createIncidentWithLocation(latitude, longitude, type) {
  const url = new URL('https://portal.ng-sos.com/create-incident');
  url.searchParams.append('type', type);
  url.searchParams.append('latitude', latitude);
  url.searchParams.append('longitude', longitude);
  
  return url.toString();
}

// Usage
const incidentUrl = createIncidentWithLocation(50.0755, 14.4378, 'medical');
// Opens form pre-filled with medical incident in Prague
```

### Example with Full Details

```javascript
function createDetailedIncident(data) {
  const url = new URL('https://portal.ng-sos.com/create-incident');
  
  // Required parameters
  url.searchParams.append('type', data.type);
  
  // Location
  if (data.latitude && data.longitude) {
    url.searchParams.append('latitude', data.latitude);
    url.searchParams.append('longitude', data.longitude);
  }
  if (data.address) {
    url.searchParams.append('address', data.address);
  }
  
  // Details
  if (data.description) {
    url.searchParams.append('description', data.description);
  }
  if (data.priority) {
    url.searchParams.append('priority', data.priority);
  }
  
  // Reporter information
  if (data.reporterName) {
    url.searchParams.append('reporterName', data.reporterName);
  }
  if (data.reporterPhone) {
    url.searchParams.append('reporterPhone', data.reporterPhone);
  }
  
  return url.toString();
}

// Usage
const url = createDetailedIncident({
  type: 'medical',
  latitude: 50.0755,
  longitude: 14.4378,
  address: 'Palladium Shopping Center, Prague',
  description: 'Person collapsed on escalator',
  priority: 'high',
  reporterName: 'John Doe',
  reporterPhone: '+420123456789'
});
```

### Available Parameters
- `type`: Incident type (required) - medical, fire, police, other
- `latitude`, `longitude`: GPS coordinates
- `address`: Human-readable address
- `description`: Incident description (max 2000 chars)
- `priority`: Priority level - low, medium, high, critical
- `reporterName`: Name of person reporting
- `reporterPhone`: Contact phone number
- `reporterEmail`: Contact email
- `tags`: Comma-separated tags

### Mobile Integration Example

```javascript
// Get user's location and create incident
navigator.geolocation.getCurrentPosition((position) => {
  const url = createDetailedIncident({
    type: 'medical',
    latitude: position.coords.latitude,
    longitude: position.coords.longitude,
    description: 'Emergency assistance needed',
    priority: 'high'
  });
  
  // Open in mobile browser
  window.location.href = url;
});
```

## How to Open Incident Archive

Access historical incidents with advanced filtering.

### Endpoint
```
GET /incident-archive
```

### Example with Date Range

```javascript
function viewIncidentArchive(startDate, endDate, type) {
  const url = new URL('https://portal.ng-sos.com/incident-archive');
  url.searchParams.append('dateFrom', startDate);
  url.searchParams.append('dateTo', endDate);
  if (type) {
    url.searchParams.append('type', type);
  }
  
  return url.toString();
}

// View medical incidents from last month
const lastMonth = new Date();
lastMonth.setMonth(lastMonth.getMonth() - 1);
const url = viewIncidentArchive(
  lastMonth.toISOString(),
  new Date().toISOString(),
  'medical'
);
```

### Available Parameters
- `dateFrom`: Start date (ISO 8601)
- `dateTo`: End date (ISO 8601)
- `type`: Incident type
- `region`: Geographic region
- `status`: Status filter
- `search`: Free-text search query
- `page`: Page number for pagination
- `pageSize`: Results per page (default: 50, max: 200)

### Advanced Search Example

```javascript
function searchArchive(searchParams) {
  const url = new URL('https://portal.ng-sos.com/incident-archive');
  
  Object.keys(searchParams).forEach(key => {
    if (searchParams[key]) {
      url.searchParams.append(key, searchParams[key]);
    }
  });
  
  return url.toString();
}

// Usage
const archiveUrl = searchArchive({
  search: 'shopping center',
  type: 'medical',
  region: 'prague',
  dateFrom: '2024-01-01',
  dateTo: '2024-01-31',
  page: 1,
  pageSize: 100
});
```

## How to Handle Return Navigation

Allow users to return to your application after portal interaction.

### Using Return URL

```javascript
function openPortalWithReturn(endpoint, params) {
  const url = new URL(`https://portal.ng-sos.com/${endpoint}`);
  
  // Add your parameters
  Object.keys(params).forEach(key => {
    url.searchParams.append(key, params[key]);
  });
  
  // Add return URL
  const returnUrl = `${window.location.origin}/callback`;
  url.searchParams.append('returnUrl', encodeURIComponent(returnUrl));
  
  window.location.href = url.toString();
}

// Usage
openPortalWithReturn('create-incident', {
  type: 'medical',
  latitude: 50.0755,
  longitude: 14.4378
});
```

### Handling Return Callback

```javascript
// On your callback page
function handlePortalReturn() {
  const params = new URLSearchParams(window.location.search);
  
  const incidentId = params.get('incidentId');
  const status = params.get('status');
  
  if (status === 'created' && incidentId) {
    console.log(`Incident ${incidentId} was created successfully`);
    // Update your application state
  } else if (status === 'cancelled') {
    console.log('User cancelled the operation');
  }
}

// Call on page load
handlePortalReturn();
```

## How to Embed Portal in iFrame

Embed portal views within your application.

### Basic iFrame

```html
<iframe 
  src="https://portal.ng-sos.com/incident-list?token=YOUR_TOKEN"
  width="100%" 
  height="600"
  frameborder="0"
  sandbox="allow-same-origin allow-scripts allow-forms">
</iframe>
```

### Dynamic iFrame with React

```jsx
import React, { useState } from 'react';

function IncidentPortal({ incidentId, apiToken }) {
  const [url] = useState(() => {
    const portalUrl = new URL('https://portal.ng-sos.com/incident-detail');
    portalUrl.searchParams.append('incidentId', incidentId);
    portalUrl.searchParams.append('token', apiToken);
    portalUrl.searchParams.append('embedded', 'true');
    return portalUrl.toString();
  });

  return (
    <div className="portal-container">
      <iframe
        src={url}
        width="100%"
        height="600"
        frameBorder="0"
        sandbox="allow-same-origin allow-scripts allow-forms"
        title="NG SOS Portal"
      />
    </div>
  );
}
```

### iFrame Communication

```javascript
// Parent page - send message to iFrame
const iframe = document.getElementById('portal-iframe');
iframe.contentWindow.postMessage({
  action: 'refreshIncidents'
}, 'https://portal.ng-sos.com');

// Listen for messages from iFrame
window.addEventListener('message', (event) => {
  if (event.origin !== 'https://portal.ng-sos.com') return;
  
  if (event.data.type === 'incidentCreated') {
    console.log('New incident:', event.data.incidentId);
    // Update your application
  }
});
```

## Best Practices

### URL Generation
- Always use `URLSearchParams` to properly encode parameters
- Validate required parameters before generating URLs
- Keep URLs under 2000 characters
- Use meaningful parameter names

### Security
- Never include sensitive tokens in URLs that will be logged
- Use POST for sensitive operations
- Implement CSRF protection
- Validate returnUrl domains

### User Experience
- Open detail views in new tabs (`target="_blank"`)
- Provide clear navigation back to your app
- Show loading indicators during redirects
- Handle errors gracefully

### Error Handling

```javascript
async function safeRedirect(url) {
  try {
    // Validate URL
    new URL(url);
    
    // Check if portal is accessible
    const response = await fetch('https://portal.ng-sos.com/health');
    if (!response.ok) {
      throw new Error('Portal is unavailable');
    }
    
    // Redirect
    window.location.href = url;
  } catch (error) {
    console.error('Failed to redirect to portal:', error);
    // Show error message to user
    alert('Unable to access NG SOS Portal. Please try again later.');
  }
}
```

## Troubleshooting

### Common Issues

**Issue**: Blank page after redirect
- **Solution**: Check if all required parameters are provided
- **Solution**: Verify API token is valid and not expired
- **Solution**: Check browser console for errors

**Issue**: Parameters not applied in portal
- **Solution**: Ensure parameters are properly URL-encoded
- **Solution**: Check parameter names match specification
- **Solution**: Verify data types (numbers as strings in URLs)

**Issue**: Authentication failures
- **Solution**: Include valid token parameter or ensure session cookies
- **Solution**: Check token expiration time
- **Solution**: Verify CORS configuration for your domain

**Issue**: iFrame not loading
- **Solution**: Check CSP and X-Frame-Options headers
- **Solution**: Ensure proper sandbox attributes
- **Solution**: Verify domain is whitelisted for embedding

## Integration Examples

### HTML/JavaScript

```html
<!DOCTYPE html>
<html>
<head>
  <title>NG SOS Integration</title>
</head>
<body>
  <button onclick="openIncidentList()">View Incidents</button>
  <button onclick="createIncident()">Report Incident</button>
  
  <script>
    function openIncidentList() {
      window.open('https://portal.ng-sos.com/incident-list', '_blank');
    }
    
    function createIncident() {
      navigator.geolocation.getCurrentPosition((pos) => {
        const url = new URL('https://portal.ng-sos.com/create-incident');
        url.searchParams.append('type', 'medical');
        url.searchParams.append('latitude', pos.coords.latitude);
        url.searchParams.append('longitude', pos.coords.longitude);
        window.open(url.toString(), '_blank');
      });
    }
  </script>
</body>
</html>
```

### React Component

```jsx
import React from 'react';

function EmergencyButton({ type, location, description }) {
  const handleEmergency = () => {
    const url = new URL('https://portal.ng-sos.com/create-incident');
    url.searchParams.append('type', type);
    url.searchParams.append('latitude', location.lat);
    url.searchParams.append('longitude', location.lng);
    url.searchParams.append('description', description);
    url.searchParams.append('priority', 'high');
    
    window.open(url.toString(), '_blank');
  };

  return (
    <button onClick={handleEmergency} className="emergency-btn">
      Report {type} Emergency
    </button>
  );
}
```

## Additional Resources

- [Portal URL OpenAPI Specification](https://github.com/medicalit-eu/ng-sos-apidoc/blob/main/specs/ng-sos-portal-url-v1.0.0.yaml)
- [Getting Started Guide](../getting-started.md)
- [EMS Documentation](../ems/overview.md)
- [PSAP Connector Documentation](../psap-connector/overview.md)

## Support

For integration assistance:
- Email: mdybal@medicalit.eu
- GitHub: [medicalit-eu/ng-sos-apidoc](https://github.com/medicalit-eu/ng-sos-apidoc)



================================================================================
OPENAPI SPECIFICATION: ng-sos-ems-v1.0.0.yaml
================================================================================

Info:
info:
  title: NG SOS Emergency message server
  description: |
    The NG SOS Emergency Message Server (EMS) is a critical component of the NG SOS platform that handles emergency message processing and management.
    
    ## Key Features
    
    - SMS reception and processing via Develogi integration
    - Emergency message handling
    - Integration endpoints for various emergency services
    - Mobile app incident management
    - PSAP connector integration
  contact:
    name: Martin Dybal
    email: mdybal@medicalit.eu
  version: 1.0.0
  x-logo:
    altText: NG SOS Logo
    url: https://apidoc.ng-sos.com/logo.svg
paths:
  /integrations/develogi/v1/sms-receive:

Paths:
  /integrations/develogi/v1/sms-receive:
  /integrations/develogi/v1/sms-status:
  /mobile-app/v1/incident:
  /mobile-app/v1/incident/{id}:
  /psap/v1/connector/request/progress/failure:
  /psap/v1/connector/request/progress/success:
  /psap/v1/incident/{id}/confirm-collaboration:
  /psap/v1/incident/{id}/reject-collaboration:
  /soap/legacy/incident/create-or-update:



================================================================================
OPENAPI SPECIFICATION: ng-sos-portal-url-v1.0.0.yaml
================================================================================

Info:
info:
  title: Portal URL Api
  description: Here you will find a description of each url of the portal. They are mainly used for easy integration into
    third party applications
  contact:
    email: mdybal@medicalit.eu
  version: 1.0.0
tags:
- name: Portal
  description: Portal URL
paths:
  /incident-list:
    get:
      tags:
      - Portal
      summary: Open incident overview
      description: Open incident overview
      operationId: OpenIncidentOverview
      responses:
        '200':
          description: successful operation

Paths:
  /incident-list:
  /create-incident:
  /incident/{IncidentId}:
  /incident-archive:



================================================================================
OPENAPI SPECIFICATION: ng-sos-psap-connector-v2.0.0.yaml
================================================================================

Info:
info:
  title: NG SOS Psap Connector server
  description: |
    The NG SOS PSAP Connector Server provides connectivity and integration between the NG SOS platform and Public Safety Answering Points (PSAPs).
    
    ## Key Features
    
    - PSAP integration and connectivity
    - Emergency call routing
    - Incident management and region assignment
    - Collaboration confirmation and rejection
    - System information and about endpoints
    - Secure authentication and authorization
  contact:
    name: Martin Dybal
    email: mdybal@medicalit.eu
  version: 2.0.0
  x-logo:
    altText: NG SOS Logo
    url: https://apidoc.ng-sos.com/logo.svg
paths:

Paths:
  /about:
  /v2/incident/{id}/region:
  /v2/incident/{id}:
  /v2/incident:
  /v2/incident/{id}/position:
  /v2/incident/{id}/battery-level:
  /v2/incident/{id}/internet-connection-type:



================================================================================
END OF DOCUMENTATION
================================================================================

For the complete interactive documentation, visit:
https://medicalit-eu.github.io/ng-sos-apidoc/

For questions and support:
Email: mdybal@medicalit.eu
GitHub: https://github.com/medicalit-eu/ng-sos-apidoc

================================================================================
